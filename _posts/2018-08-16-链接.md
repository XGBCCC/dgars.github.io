---
layout: post
title: 链接
category: tech
tag: 深入理解计算机系统
--- 

#### 编译器驱动程序

##### 7.1 编译流程
例如：编译main.c[gcc -Og -o prog main.c]
1. 运行C预处理器(cpp),将C的源程序翻译为ASCII码的中间文件main.i
2. 运行C编译器(ccl),将mian.i翻译成ASCII汇编语言文件main.s
3. 运行汇编器(as),将main.s翻译成`可重定位目标文件`,main.o
4. 运行链接器程序(ld),将main.o以及一些必要的系统目标文件结合起来,形成一个可执行目标文件(prog)

###### 运行可执行文件
例如:要运行我们上面生成的prog[./prog]
shell调用操作系统中一个叫做加载器(loader)的函数，将可执行文件中的代码和数据复制到内存，然后将控制转移到这个程序的开头


#### 7.2 静态链接
连接器主要有2个任务：
1. 符号解析：目标文件定义和引用的符号都对应一个函数OR变量。符号解析的目的是将符号引用跟符号定义关联起来
2. 重定位：编译器合汇编器生成从地址0开始的代码和数据姐。连接器通过把每个符号定义与一个内存地址关联起来，从而重定位这些节。然后修改对这些符号的引用，使他们指向对应的地址

#### 7.3 目标文件
1. 可重定位目标文件:对应生成的.o 文件
2. 可执行目标文件:可以直接执行的文件,对.o文件进行连接后，可以直接加载到内存并执行的文件
3. 共享目标文件:可以在加载或运行时被动态的加载进内存并链接,类似framework

#### 7.4 可重定位目标文件
.O文件，可以用MatchOView打开，或者在命令行使用：来查看
其中:
1. .symtab：符号表，它存放在程序中定义合引用的函数和全局变量的信息(每个重定向文件中都会有一张符号表,除非特意用STRIP去掉),`这个符号表和debug的符号表不同`,.symtab符号表不包含局部变量的条目
2. .debug: 调试符号表，包含了局部变量，类型定义+全局便利，以及原始的C源文件(就是我们的dSYM)，只有用-g选项调用编译器驱动程序时，才会生成这张表

#### 7.5 符号和解析表
